<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chunnakam Grid - Comprehensive Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e3a5f;
            --secondary: #2d5a87;
            --accent: #f39c12;
            --success: #27ae60;
            --warning: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #bdc3c7;
            font-size: 1.2em;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-card .label {
            color: #bdc3c7;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title .icon {
            font-size: 1.5em;
        }

        /* Grid Topology */
        .topology-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .substation {
            background: linear-gradient(145deg, #c0392b, #e74c3c);
            padding: 20px 40px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(231,76,60,0.4);
        }

        .transformers {
            display: flex;
            gap: 100px;
            margin-bottom: 20px;
        }

        .transformer {
            background: linear-gradient(145deg, #8e44ad, #9b59b6);
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(155,89,182,0.4);
        }

        .bus-sections {
            display: flex;
            gap: 50px;
            margin-bottom: 30px;
        }

        .bus-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bus-bar {
            width: 400px;
            height: 15px;
            background: linear-gradient(90deg, #f39c12, #e67e22);
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: 0 0 20px rgba(243,156,18,0.5);
        }

        .feeders-row {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }

        .feeder {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }

        .feeder-line {
            width: 3px;
            height: 50px;
            background: #3498db;
        }

        .feeder-box {
            background: linear-gradient(145deg, #2980b9, #3498db);
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            font-size: 0.9em;
            box-shadow: 0 5px 15px rgba(52,152,219,0.4);
        }

        .feeder-box.industrial { background: linear-gradient(145deg, #d35400, #e67e22); }
        .feeder-box.rural { background: linear-gradient(145deg, #27ae60, #2ecc71); }
        .feeder-box.urban { background: linear-gradient(145deg, #8e44ad, #9b59b6); }
        .feeder-box.coastal { background: linear-gradient(145deg, #16a085, #1abc9c); }
        .feeder-box.generator { background: linear-gradient(145deg, #c0392b, #e74c3c); }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.95em;
        }

        .data-table th {
            background: rgba(52,152,219,0.3);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .data-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .data-table .highlight {
            color: #f39c12;
            font-weight: bold;
        }

        .data-table .positive { color: #2ecc71; }
        .data-table .negative { color: #e74c3c; }

        /* Charts Container */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .chart-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #f39c12;
        }

        /* Household Analysis */
        .household-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .household-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }

        .household-card:hover {
            transform: scale(1.02);
            border-color: #f39c12;
        }

        .household-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .household-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #3498db;
        }

        .feeder-badge {
            background: linear-gradient(90deg, #f39c12, #e67e22);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .household-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .household-stat {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .household-stat .value {
            font-size: 1.4em;
            font-weight: bold;
        }

        .household-stat .label {
            font-size: 0.8em;
            color: #bdc3c7;
        }

        .household-stat.load .value { color: #e74c3c; }
        .household-stat.solar .value { color: #f39c12; }
        .household-stat.net .value { color: #2ecc71; }
        .household-stat.pf .value { color: #9b59b6; }

        .net-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .net-status.exporter {
            background: rgba(46,204,113,0.2);
            color: #2ecc71;
            border: 1px solid #2ecc71;
        }

        .net-status.consumer {
            background: rgba(231,76,60,0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        /* Analysis Capability Section */
        .capability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .capability-card {
            background: linear-gradient(145deg, rgba(46,204,113,0.1), rgba(39,174,96,0.05));
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(46,204,113,0.3);
        }

        .capability-card h3 {
            color: #2ecc71;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .capability-card ul {
            list-style: none;
            padding-left: 0;
        }

        .capability-card li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .capability-card li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #2ecc71;
        }

        /* Tabs */
        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 12px 25px;
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .tab-btn.active {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
        }

        /* Profile Selector */
        .profile-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .profile-selector select {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }

        .profile-selector select option {
            background: #2c3e50;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <h1>Chunnakam Grid Substation</h1>
            <div class="subtitle">Jaffna District, Northern Sri Lanka - Comprehensive Grid Analysis Dashboard</div>
        </div>

        <!-- Summary Stats -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="value">73.5</div>
                <div class="label">Total Peak Load (MW)</div>
            </div>
            <div class="stat-card">
                <div class="value">47.32</div>
                <div class="label">Total Solar PV (MW)</div>
            </div>
            <div class="stat-card">
                <div class="value">22</div>
                <div class="label">Households/Loads</div>
            </div>
            <div class="stat-card">
                <div class="value">7</div>
                <div class="label">Distribution Feeders</div>
            </div>
            <div class="stat-card">
                <div class="value">63</div>
                <div class="label">Grid Transformers (MVA)</div>
            </div>
            <div class="stat-card">
                <div class="value">64%</div>
                <div class="label">PV Penetration</div>
            </div>
        </div>

        <!-- Grid Topology Section -->
        <div class="section">
            <div class="section-title">
                <span class="icon">üîå</span>
                Grid Topology Overview
            </div>
            <div class="topology-container">
                <div class="substation">132 kV Source (1500 MVA)</div>

                <div class="transformers">
                    <div class="transformer">
                        <div><strong>TR2</strong></div>
                        <div>31.5 MVA</div>
                        <div>132/33 kV</div>
                    </div>
                    <div class="transformer">
                        <div><strong>TR3</strong></div>
                        <div>31.5 MVA</div>
                        <div>132/33 kV</div>
                    </div>
                </div>

                <div class="bus-sections">
                    <div class="bus-section">
                        <strong>Bus Section A</strong>
                        <div class="bus-bar"></div>
                        <div class="feeders-row">
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box generator">
                                    <strong>F05</strong><br>
                                    UJPS<br>
                                    24 MW Gen
                                </div>
                            </div>
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box industrial">
                                    <strong>F06</strong><br>
                                    KKS Industrial<br>
                                    6.2 MW | 10.14 MW PV
                                </div>
                            </div>
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box">
                                    <strong>F07</strong><br>
                                    Vaddu Mixed<br>
                                    7.8 MW | 9.17 MW PV
                                </div>
                            </div>
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box">
                                    <strong>F08</strong><br>
                                    Kompanai<br>
                                    12.6 MW | 5.44 MW PV
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bus-section">
                        <strong>Bus Section B</strong>
                        <div class="bus-bar"></div>
                        <div class="feeders-row">
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box rural">
                                    <strong>F09</strong><br>
                                    Chavakachcheri<br>
                                    7.2 MW | 0.35 MW PV
                                </div>
                            </div>
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box coastal">
                                    <strong>F10</strong><br>
                                    Point Pedro<br>
                                    12.6 MW | 7.0 MW PV
                                </div>
                            </div>
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box urban">
                                    <strong>F11</strong><br>
                                    Jaffna Town<br>
                                    14.4 MW | 10.22 MW PV
                                </div>
                            </div>
                            <div class="feeder">
                                <div class="feeder-line"></div>
                                <div class="feeder-box">
                                    <strong>F12</strong><br>
                                    Tie Feeder<br>
                                    12.7 MW | 5.0 MW PV
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(145deg, #d35400, #e67e22);"></div>
                        <span>Industrial</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(145deg, #27ae60, #2ecc71);"></div>
                        <span>Rural</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(145deg, #8e44ad, #9b59b6);"></div>
                        <span>Urban</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(145deg, #16a085, #1abc9c);"></div>
                        <span>Coastal</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(145deg, #c0392b, #e74c3c);"></div>
                        <span>Generator</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feeder Summary Table -->
        <div class="section">
            <div class="section-title">
                <span class="icon">üìä</span>
                Feeder-wise Load & Generation Summary
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Feeder</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Distance (km)</th>
                        <th>Households</th>
                        <th>Peak Load (MW)</th>
                        <th>Solar PV (MW)</th>
                        <th>Net Export %</th>
                        <th>PV/Load Ratio</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="highlight">F06</td>
                        <td>KKS Industrial</td>
                        <td>Industrial</td>
                        <td>10</td>
                        <td>3</td>
                        <td>6.20</td>
                        <td>10.14</td>
                        <td class="positive">16.3%</td>
                        <td>163%</td>
                    </tr>
                    <tr>
                        <td class="highlight">F07</td>
                        <td>Vaddu</td>
                        <td>Mixed/Agriculture</td>
                        <td>12</td>
                        <td>3</td>
                        <td>7.80</td>
                        <td>9.17</td>
                        <td class="positive">19.6%</td>
                        <td>118%</td>
                    </tr>
                    <tr>
                        <td class="highlight">F08</td>
                        <td>Kompanai</td>
                        <td>Distribution</td>
                        <td>10</td>
                        <td>3</td>
                        <td>12.60</td>
                        <td>5.44</td>
                        <td class="positive">9.0%</td>
                        <td>43%</td>
                    </tr>
                    <tr>
                        <td class="highlight">F09</td>
                        <td>Chavakachcheri</td>
                        <td>Rural</td>
                        <td>18</td>
                        <td>4</td>
                        <td>7.20</td>
                        <td>0.35</td>
                        <td class="positive">23.7%</td>
                        <td>5%</td>
                    </tr>
                    <tr>
                        <td class="highlight">F10</td>
                        <td>Point Pedro</td>
                        <td>Coastal</td>
                        <td>14</td>
                        <td>3</td>
                        <td>12.60</td>
                        <td>7.00</td>
                        <td class="positive">25.7%</td>
                        <td>56%</td>
                    </tr>
                    <tr>
                        <td class="highlight">F11</td>
                        <td>Jaffna Town</td>
                        <td>Urban</td>
                        <td>8</td>
                        <td>4</td>
                        <td>14.40</td>
                        <td>10.22</td>
                        <td class="positive">56.2%</td>
                        <td>71%</td>
                    </tr>
                    <tr>
                        <td class="highlight">F12</td>
                        <td>Tie Feeder</td>
                        <td>Residential</td>
                        <td>10</td>
                        <td>2</td>
                        <td>12.70</td>
                        <td>5.00</td>
                        <td class="positive">18.3%</td>
                        <td>39%</td>
                    </tr>
                    <tr style="background: rgba(243,156,18,0.2); font-weight: bold;">
                        <td>TOTAL</td>
                        <td colspan="3">7 Feeders</td>
                        <td>22</td>
                        <td>73.50</td>
                        <td>47.32</td>
                        <td>-</td>
                        <td>64%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Load Profiles Section -->
        <div class="section">
            <div class="section-title">
                <span class="icon">üìà</span>
                24-Hour Load & Generation Profiles
            </div>
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Load Profiles by Consumer Type</div>
                    <canvas id="loadProfileChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Solar Irradiance Profiles</div>
                    <canvas id="solarProfileChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Household Analysis Section -->
        <div class="section">
            <div class="section-title">
                <span class="icon">üè†</span>
                Individual Household Load & Solar Analysis
            </div>

            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('all')">All Households</button>
                    <button class="tab-btn" onclick="showTab('f06')">F06 Industrial</button>
                    <button class="tab-btn" onclick="showTab('f07')">F07 Mixed</button>
                    <button class="tab-btn" onclick="showTab('f08')">F08 Distribution</button>
                    <button class="tab-btn" onclick="showTab('f09')">F09 Rural</button>
                    <button class="tab-btn" onclick="showTab('f10')">F10 Coastal</button>
                    <button class="tab-btn" onclick="showTab('f11')">F11 Urban</button>
                    <button class="tab-btn" onclick="showTab('f12')">F12 Tie</button>
                </div>

                <div id="all" class="tab-content active">
                    <div class="household-grid">
                        <!-- F06 Households -->
                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F06_Industrial_Factory</span>
                                <span class="feeder-badge">F06</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">4,000</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">5,000</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">+1,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.86</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status exporter">Net Exporter (125% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F06_SmallIndustry</span>
                                <span class="feeder-badge">F06</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">1,500</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">3,500</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">+2,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.89</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status exporter">Net Exporter (233% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F06_Residential</span>
                                <span class="feeder-badge">F06</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">700</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">1,640</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">+940</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status exporter">Net Exporter (234% PV/Load)</div>
                        </div>

                        <!-- F07 Households -->
                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F07_Village_Center</span>
                                <span class="feeder-badge">F07</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">2,500</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">4,000</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">+1,500</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status exporter">Net Exporter (160% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F07_Agricultural</span>
                                <span class="feeder-badge">F07</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">3,000</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">3,500</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">+500</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.82</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status exporter">Net Exporter (117% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F07_Rural_Houses</span>
                                <span class="feeder-badge">F07</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">2,300</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">1,670</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-630</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (73% PV/Load)</div>
                        </div>

                        <!-- F08 Households -->
                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F08_Commercial</span>
                                <span class="feeder-badge">F08</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">5,000</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">2,500</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-2,500</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (50% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F08_Residential</span>
                                <span class="feeder-badge">F08</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">4,500</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">2,000</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-2,500</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (44% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F08_Mixed</span>
                                <span class="feeder-badge">F08</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">3,100</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">940</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-2,160</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (30% PV/Load)</div>
                        </div>

                        <!-- F09 Households -->
                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F09_Town_Center</span>
                                <span class="feeder-badge">F09</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">2,200</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">200</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-2,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (9% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F09_Village</span>
                                <span class="feeder-badge">F09</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">1,800</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">150</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-1,650</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (8% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F09_Rural_Agri</span>
                                <span class="feeder-badge">F09</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">2,000</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">0</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-2,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.89</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">No Solar - Pure Consumer</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F09_Remote</span>
                                <span class="feeder-badge">F09</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">1,200</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">0</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-1,200</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">No Solar - Pure Consumer</div>
                        </div>

                        <!-- F10 Households -->
                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F10_Town</span>
                                <span class="feeder-badge">F10</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">5,500</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">3,500</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-2,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (64% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F10_Fishing</span>
                                <span class="feeder-badge">F10</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">4,000</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">2,000</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-2,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.89</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (50% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F10_Coastal_Res</span>
                                <span class="feeder-badge">F10</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">3,100</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">1,500</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-1,600</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (48% PV/Load)</div>
                        </div>

                        <!-- F11 Households -->
                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F11_Hospital (Critical)</span>
                                <span class="feeder-badge">F11</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">2,500</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">1,500</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-1,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.89</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Critical Load (60% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F11_Commercial</span>
                                <span class="feeder-badge">F11</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">4,500</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">3,500</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-1,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (78% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F11_Apartments</span>
                                <span class="feeder-badge">F11</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">4,000</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">3,000</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-1,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (75% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F11_MixedRes</span>
                                <span class="feeder-badge">F11</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">3,400</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">2,220</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-1,180</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (65% PV/Load)</div>
                        </div>

                        <!-- F12 Households -->
                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F12_Residential1</span>
                                <span class="feeder-badge">F12</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">7,000</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">3,000</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-4,000</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (43% PV/Load)</div>
                        </div>

                        <div class="household-card">
                            <div class="household-header">
                                <span class="household-name">F12_Residential2</span>
                                <span class="feeder-badge">F12</span>
                            </div>
                            <div class="household-stats">
                                <div class="household-stat load">
                                    <div class="value">5,700</div>
                                    <div class="label">Load (kW)</div>
                                </div>
                                <div class="household-stat solar">
                                    <div class="value">2,000</div>
                                    <div class="label">Solar PV (kW)</div>
                                </div>
                                <div class="household-stat net">
                                    <div class="value">-3,700</div>
                                    <div class="label">Net @ Peak Solar</div>
                                </div>
                                <div class="household-stat pf">
                                    <div class="value">0.93</div>
                                    <div class="label">Power Factor</div>
                                </div>
                            </div>
                            <div class="net-status consumer">Net Consumer (35% PV/Load)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Per-Household Dynamic Analysis -->
        <div class="section">
            <div class="section-title">
                <span class="icon">‚ö°</span>
                Per-Household 24-Hour Load & Solar Dynamics
            </div>

            <div class="profile-selector">
                <label>Select Household:</label>
                <select id="householdSelect" onchange="updateHouseholdChart()">
                    <option value="f06_factory">F06 - Industrial Factory (4 MW Load, 5 MW PV)</option>
                    <option value="f06_small">F06 - Small Industry (1.5 MW Load, 3.5 MW PV)</option>
                    <option value="f07_village">F07 - Village Center (2.5 MW Load, 4 MW PV)</option>
                    <option value="f07_agri">F07 - Agricultural (3 MW Load, 3.5 MW PV)</option>
                    <option value="f09_town">F09 - Town Center (2.2 MW Load, 0.2 MW PV)</option>
                    <option value="f10_fishing">F10 - Fishing Village (4 MW Load, 2 MW PV)</option>
                    <option value="f11_hospital">F11 - Hospital (2.5 MW Load, 1.5 MW PV)</option>
                    <option value="f11_commercial">F11 - Commercial (4.5 MW Load, 3.5 MW PV)</option>
                    <option value="f12_res1">F12 - Residential 1 (7 MW Load, 3 MW PV)</option>
                </select>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Household Load vs Solar Generation (24h)</div>
                    <canvas id="householdDynamicChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Net Power Flow (Import/Export)</div>
                    <canvas id="netFlowChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Analysis Capabilities Section -->
        <div class="section">
            <div class="section-title">
                <span class="icon">‚úÖ</span>
                Individual Household Analysis Capabilities
            </div>

            <p style="margin-bottom: 20px; color: #bdc3c7; font-size: 1.1em;">
                <strong>YES - The grid model fully supports individual household analysis!</strong> Each of the 22 households has separate load and solar PV system definitions, enabling detailed per-household analysis.
            </p>

            <div class="capability-grid">
                <div class="capability-card">
                    <h3>üìä Load Analysis (Per Household)</h3>
                    <ul>
                        <li>Peak load (kW) for each household</li>
                        <li>Power factor by consumer type</li>
                        <li>24-hour load profile (hourly resolution)</li>
                        <li>Load model type (Constant P or Z)</li>
                        <li>Voltage limits per critical load</li>
                        <li>Reactive power (kvar) consumption</li>
                    </ul>
                </div>

                <div class="capability-card">
                    <h3>‚òÄÔ∏è Solar Generation (Per Household)</h3>
                    <ul>
                        <li>PV capacity (Pmpp) per household</li>
                        <li>Inverter efficiency curves</li>
                        <li>Temperature derating factors</li>
                        <li>24-hour irradiance profiles</li>
                        <li>15-minute resolution for stability</li>
                        <li>Net metering vs self-consumption</li>
                    </ul>
                </div>

                <div class="capability-card">
                    <h3>üîå Net Power Analysis</h3>
                    <ul>
                        <li>Hourly net import/export calculation</li>
                        <li>Export time percentage</li>
                        <li>Peak export/import periods</li>
                        <li>Self-sufficiency ratio</li>
                        <li>Grid dependency analysis</li>
                        <li>Feeder-level aggregation</li>
                    </ul>
                </div>

                <div class="capability-card">
                    <h3>üìà Time-Series Simulation</h3>
                    <ul>
                        <li>24-hour daily simulation</li>
                        <li>Hourly or 15-min resolution</li>
                        <li>Monthly variation factors</li>
                        <li>Weather scenario modeling</li>
                        <li>Voltage profile tracking</li>
                        <li>Power flow at each bus</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: rgba(243,156,18,0.1); border-radius: 15px; border: 1px solid rgba(243,156,18,0.3);">
                <h3 style="color: #f39c12; margin-bottom: 15px;">üí° How to Access Per-Household Data</h3>
                <table class="data-table" style="margin-top: 10px;">
                    <tr>
                        <th>Data Type</th>
                        <th>Source File</th>
                        <th>Key Parameters</th>
                    </tr>
                    <tr>
                        <td>Load Definition</td>
                        <td>Households.dss</td>
                        <td>kW, kvar, model, daily shape, bus</td>
                    </tr>
                    <tr>
                        <td>Solar PV Definition</td>
                        <td>RooftopSolar.dss</td>
                        <td>Pmpp, irradiance, efficiency curve</td>
                    </tr>
                    <tr>
                        <td>Load Profiles</td>
                        <td>LoadShapes.dss</td>
                        <td>24-point hourly multipliers</td>
                    </tr>
                    <tr>
                        <td>Solar Profiles</td>
                        <td>LoadShapes.dss</td>
                        <td>Solar_Default_Daily, Solar_15min</td>
                    </tr>
                    <tr>
                        <td>API Access</td>
                        <td>opendss_service.py</td>
                        <td>get_grid_state(), run_time_series()</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="footer">
            <p>Chunnakam Grid Analysis Dashboard | Data from OpenDSS Model | Generated: <span id="genDate"></span></p>
        </div>
    </div>

    <script>
        // Set generation date
        document.getElementById('genDate').textContent = new Date().toLocaleString();

        // Hours array for x-axis
        const hours = Array.from({length: 24}, (_, i) => `${i}:00`);

        // Load Profiles Data (from LoadShapes.dss)
        const loadProfiles = {
            residential: [0.35, 0.30, 0.28, 0.27, 0.28, 0.45, 0.70, 0.75, 0.55, 0.40, 0.35, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, 0.75, 0.95, 1.00, 0.90, 0.75, 0.55, 0.42],
            ruralResidential: [0.40, 0.35, 0.32, 0.30, 0.35, 0.55, 0.80, 0.65, 0.45, 0.35, 0.30, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.70, 1.00, 0.95, 0.85, 0.70, 0.55, 0.45],
            commercial: [0.20, 0.15, 0.15, 0.15, 0.15, 0.20, 0.35, 0.55, 0.80, 0.95, 1.00, 0.95, 0.90, 0.90, 0.85, 0.80, 0.85, 0.90, 0.75, 0.50, 0.35, 0.30, 0.25, 0.22],
            industrial: [0.60, 0.55, 0.52, 0.50, 0.50, 0.55, 0.62, 0.65, 0.55, 0.45, 0.35, 0.30, 0.30, 0.32, 0.35, 0.45, 0.60, 0.80, 0.95, 1.00, 0.98, 0.90, 0.78, 0.68],
            hospital: [0.70, 0.65, 0.62, 0.60, 0.62, 0.70, 0.85, 0.95, 1.00, 1.00, 0.98, 0.95, 0.92, 0.90, 0.88, 0.85, 0.82, 0.85, 0.88, 0.85, 0.80, 0.78, 0.75, 0.72],
            agricultural: [0.10, 0.08, 0.08, 0.10, 0.25, 0.70, 0.95, 1.00, 0.80, 0.40, 0.20, 0.15, 0.15, 0.18, 0.25, 0.55, 0.85, 0.90, 0.70, 0.35, 0.20, 0.15, 0.12, 0.10]
        };

        // Solar Profiles
        const solarProfiles = {
            sunny: [0.00, 0.00, 0.00, 0.00, 0.00, 0.02, 0.15, 0.40, 0.65, 0.85, 0.95, 1.00, 0.98, 0.90, 0.75, 0.55, 0.30, 0.10, 0.02, 0.00, 0.00, 0.00, 0.00, 0.00],
            default: [0.00, 0.00, 0.00, 0.00, 0.00, 0.02, 0.12, 0.32, 0.52, 0.70, 0.82, 0.85, 0.83, 0.75, 0.60, 0.42, 0.22, 0.07, 0.01, 0.00, 0.00, 0.00, 0.00, 0.00],
            partlyCloudy: [0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.09, 0.24, 0.39, 0.51, 0.57, 0.60, 0.59, 0.54, 0.45, 0.33, 0.18, 0.06, 0.01, 0.00, 0.00, 0.00, 0.00, 0.00],
            cloudy: [0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.05, 0.12, 0.20, 0.26, 0.29, 0.30, 0.29, 0.27, 0.23, 0.17, 0.09, 0.03, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00]
        };

        // Household configurations
        const households = {
            f06_factory: { name: 'F06 Industrial Factory', load: 4000, pv: 5000, loadProfile: 'industrial' },
            f06_small: { name: 'F06 Small Industry', load: 1500, pv: 3500, loadProfile: 'industrial' },
            f07_village: { name: 'F07 Village Center', load: 2500, pv: 4000, loadProfile: 'residential' },
            f07_agri: { name: 'F07 Agricultural', load: 3000, pv: 3500, loadProfile: 'agricultural' },
            f09_town: { name: 'F09 Town Center', load: 2200, pv: 200, loadProfile: 'residential' },
            f10_fishing: { name: 'F10 Fishing Village', load: 4000, pv: 2000, loadProfile: 'industrial' },
            f11_hospital: { name: 'F11 Hospital', load: 2500, pv: 1500, loadProfile: 'hospital' },
            f11_commercial: { name: 'F11 Commercial', load: 4500, pv: 3500, loadProfile: 'commercial' },
            f12_res1: { name: 'F12 Residential 1', load: 7000, pv: 3000, loadProfile: 'residential' }
        };

        // Load Profiles Chart
        const loadCtx = document.getElementById('loadProfileChart').getContext('2d');
        const loadChart = new Chart(loadCtx, {
            type: 'line',
            data: {
                labels: hours,
                datasets: [
                    { label: 'Residential', data: loadProfiles.residential, borderColor: '#3498db', fill: false, tension: 0.3 },
                    { label: 'Commercial', data: loadProfiles.commercial, borderColor: '#e74c3c', fill: false, tension: 0.3 },
                    { label: 'Industrial', data: loadProfiles.industrial, borderColor: '#f39c12', fill: false, tension: 0.3 },
                    { label: 'Hospital', data: loadProfiles.hospital, borderColor: '#9b59b6', fill: false, tension: 0.3 },
                    { label: 'Agricultural', data: loadProfiles.agricultural, borderColor: '#2ecc71', fill: false, tension: 0.3 }
                ]
            },
            options: {
                responsive: true,
                plugins: { legend: { labels: { color: '#fff' } } },
                scales: {
                    x: { ticks: { color: '#bdc3c7' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    y: {
                        ticks: { color: '#bdc3c7' },
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        title: { display: true, text: 'Per-Unit Load', color: '#bdc3c7' }
                    }
                }
            }
        });

        // Solar Profiles Chart
        const solarCtx = document.getElementById('solarProfileChart').getContext('2d');
        const solarChart = new Chart(solarCtx, {
            type: 'line',
            data: {
                labels: hours,
                datasets: [
                    { label: 'Sunny Day', data: solarProfiles.sunny, borderColor: '#f39c12', backgroundColor: 'rgba(243,156,18,0.2)', fill: true, tension: 0.3 },
                    { label: 'Default (Avg)', data: solarProfiles.default, borderColor: '#e67e22', fill: false, tension: 0.3 },
                    { label: 'Partly Cloudy', data: solarProfiles.partlyCloudy, borderColor: '#95a5a6', fill: false, tension: 0.3 },
                    { label: 'Cloudy', data: solarProfiles.cloudy, borderColor: '#7f8c8d', fill: false, tension: 0.3 }
                ]
            },
            options: {
                responsive: true,
                plugins: { legend: { labels: { color: '#fff' } } },
                scales: {
                    x: { ticks: { color: '#bdc3c7' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    y: {
                        ticks: { color: '#bdc3c7' },
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        title: { display: true, text: 'Per-Unit Irradiance', color: '#bdc3c7' }
                    }
                }
            }
        });

        // Household Dynamic Chart
        let householdDynamicChart, netFlowChart;

        function initHouseholdCharts() {
            const dynamicCtx = document.getElementById('householdDynamicChart').getContext('2d');
            householdDynamicChart = new Chart(dynamicCtx, {
                type: 'line',
                data: { labels: hours, datasets: [] },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#bdc3c7' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: {
                            ticks: { color: '#bdc3c7' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            title: { display: true, text: 'Power (kW)', color: '#bdc3c7' }
                        }
                    }
                }
            });

            const netCtx = document.getElementById('netFlowChart').getContext('2d');
            netFlowChart = new Chart(netCtx, {
                type: 'bar',
                data: { labels: hours, datasets: [] },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#bdc3c7' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: {
                            ticks: { color: '#bdc3c7' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            title: { display: true, text: 'Net Power (kW) - Negative=Import', color: '#bdc3c7' }
                        }
                    }
                }
            });

            updateHouseholdChart();
        }

        function updateHouseholdChart() {
            const selected = document.getElementById('householdSelect').value;
            const hh = households[selected];
            const profile = loadProfiles[hh.loadProfile];

            // Calculate actual load and solar for each hour
            const loadData = profile.map(p => p * hh.load);
            const solarData = solarProfiles.default.map(s => s * hh.pv);
            const netData = loadData.map((l, i) => solarData[i] - l);

            householdDynamicChart.data.datasets = [
                {
                    label: 'Load (kW)',
                    data: loadData,
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231,76,60,0.2)',
                    fill: true,
                    tension: 0.3
                },
                {
                    label: 'Solar PV (kW)',
                    data: solarData,
                    borderColor: '#f39c12',
                    backgroundColor: 'rgba(243,156,18,0.2)',
                    fill: true,
                    tension: 0.3
                }
            ];
            householdDynamicChart.update();

            // Net flow chart with colors
            const colors = netData.map(n => n >= 0 ? 'rgba(46,204,113,0.8)' : 'rgba(231,76,60,0.8)');
            netFlowChart.data.datasets = [
                {
                    label: 'Net Power (+ Export, - Import)',
                    data: netData,
                    backgroundColor: colors,
                    borderColor: colors.map(c => c.replace('0.8', '1')),
                    borderWidth: 1
                }
            ];
            netFlowChart.update();
        }

        // Tab functionality
        function showTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Initialize charts on load
        window.onload = initHouseholdCharts;
    </script>
</body>
</html>
